var piiScrubberTask=function(){"use strict";return function(e,r,a,n,t){if(void 0===r&&(r=[]),void 0===a&&(a=[]),void 0===t&&(t=!1),!e)return console.error("piiScrubberTask: Request is required."),e;var o=["email","mail","name","surname"].concat(r).filter(Boolean),c=[{id:"email",regex:/[a-zA-Z0-9-_.]+@[a-zA-Z0-9-_.]+/,replacement:"[email_redacted]"}].concat(a).filter(Boolean),i={},s=[],l=function(e,r){null!==e?Object.entries(e).forEach((function(a){var n=a[0],t=a[1];if(c.forEach((function(a){var o=a.id,c=a.regex,l=a.replacement;"string"==typeof t&&c.test(t)&&(i[n]={origin:r,rule:"matched pattern: ".concat(o),original:t,scrubbed:t.replace(c,l)},e[n]=t.replace(c,l),s.push(n))})),"string"==typeof t&&function(e){return/^(?:[a-zA-Z][a-zA-Z\d+\-.]*:\/\/[^\s]*)(?:\?[^\s]*)?$/.test(e)}(t))try{var l=new URL(t),u=new URLSearchParams(l.search);o.forEach((function(e){u.has(e)&&(u.set(e,"parameter_removed"),i[n]={origin:r,rule:"blacklisted parameter",original:t,scrubbed:l.toString()},s.push(e))})),u.forEach((function(e,a){c.forEach((function(t){var o=t.id,c=t.regex,d=t.replacement;if(c.test(e)){var f=e.replace(c,d);u.set(a,f),i[n]={origin:r,rule:"matched pattern: ".concat(o),original:l.toString(),scrubbed:f},s.push(a)}}))})),l.search=u.toString(),e[n]=l.toString()}catch(e){console.error("Invalid URL:",t,e)}})):console.warn("Skipping scrubbing for ".concat(r," as data is null"))};return l(e.sharedPayload,"sharedPayload"),e.events.forEach((function(e){return l(e,"events")})),n&&s.length>0&&n(i),t&&Object.keys(i).length>0&&(console.groupCollapsed("PII Scrubber: Scrubbed Data"),console.log(i),console.groupEnd()),e}}();
